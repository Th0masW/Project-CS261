{"version":3,"sources":["../../lib/disneytokyo/index.js"],"names":["random_useragent","require","Moment","Park","s_apiKey","Symbol","s_apiAuth","s_apiOS","s_apiVersion","s_apiBase","s_webUserAgent","s_parkID","s_deviceID","DisneyTokyoPark","options","name","timezone","useragent","api_key","api_auth","api_os","api_version","api_base","park_id","undefined","Error","getRandom","ua","osName","headers","connection","Depth","OriginalVersion","TestVersion","Promise","reject","HTTP","url","method","GetAPIHeaders","then","resp","latest","split","map","x","idx","Number","join","Log","resolve","Cache","Wrap","data","deviceId","CheckLatest","FetchRideData","rides","FetchWaitTimesJSON","i","attractions","length","ride","id","standbyTimeDisplayType","type","rideObject","GetRideObject","FastPass","fastpass","operatingStatus","WaitTime","facilityStatus","standbyTime","FetchDeviceID","GetEnglishNames","englishNames","body","rideData","attr","parkType","toLowerCase","englishData","facilityCode","nameKana","attractionType","retryDelay","regexGetRideNames","match","exec","area","matches","compId","push","today","tz","Timezone","format","FetchCalendarJSON","day","Schedule","SetDate","date","openingTime","openTime","closingTime","closeTime","closedDay","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nconst random_useragent = require(\"random-useragent\");\n\nconst Moment = require(\"moment-timezone\");\n\nconst Park = require(\"../park\");\n\nconst s_apiKey = Symbol();\nconst s_apiAuth = Symbol();\nconst s_apiOS = Symbol();\nconst s_apiVersion = Symbol();\nconst s_apiBase = Symbol();\nconst s_webUserAgent = Symbol();\nconst s_parkID = Symbol();\nconst s_deviceID = Symbol();\n\n/**\n * Implements the Tokyo Disneyland API framework.\n * @class\n * @extends Park\n */\nclass DisneyTokyoPark extends Park {\n    /**\n     * Create new DisneyTokyoPark Object.\n     * This object should not be called directly, but rather extended for each of the individual Tokyo Disneyland parks\n     * @param {Object} options\n     * @param {String} options.park_id Tokyo Disneyland API park ID\n     */\n    constructor(options = {}) {\n        options.name = options.name || \"Tokyo Disneyland Park\";\n        options.timezone = options.timezone || \"Asia/Tokyo\";\n\n        options.useragent = options.useragent || \"TokyoDisneyResortApp/1.0.12 Android/8.1.0\";\n\n        // inherit from base class\n        super(options);\n\n        this[s_apiKey] = options.api_key || \"818982cd6a62e7927700a4fbabcd4534a4657a422711a83c725433839b172371\";\n        this[s_apiAuth] = options.api_auth || \"MmYyZDYzehoVwD52FWYyDvo22aGvetu6uaGGKdN6FILO9lp2XS17DF//BA+Gake8oJ0GKlGnJDWu/boVa32d7PfCeTqCJA==\";\n        this[s_apiOS] = options.api_os || \"Android 8.1.0\";\n        this[s_apiVersion] = options.api_version || \"1.0.12\";\n        this[s_apiBase] = options.api_base || \"https://api-portal.tokyodisneyresort.jp\";\n\n        if (options.park_id === undefined) throw new Error(\"No Park ID passed to DisneyTokyoPark object constructor\");\n        this[s_parkID] = options.park_id;\n\n        this[s_webUserAgent] = random_useragent.getRandom((ua) => ua.osName == \"Android\");\n    }\n\n    // override Fastpass Getter to declare support for Fastpass\n    get FastPass() {\n        return true;\n    }\n\n    /**\n     * Refresh/Fetch new Wait Times for this Tokyo Disney Resort park\n     * @returns {Promise}\n     */\n    GetAPIHeaders() {\n        const headers = {\n            \"x-api-key\": this[s_apiKey],\n            \"X-PORTAL-LANGUAGE\": \"ja\",\n            \"X-PORTAL-OS-VERSION\": this[s_apiOS],\n            \"X-PORTAL-APP-VERSION\": this[s_apiVersion],\n            \"X-PORTAL-AUTH\": this[s_apiAuth],\n            \"X-PORTAL-DEVICE-NAME\": \"shamu\",\n            connection: \"keep-alive\",\n            \"Accept-Encoding\": \"gzip\",\n            \"Accept\": \"application/json\",\n            \"Content-Type\": \"application/json\",\n        };\n\n        if (this[s_deviceID]) {\n            headers[\"X-PORTAL-DEVICE-ID\"] = this[s_deviceID];\n        }\n\n        return headers;\n    }\n\n    CheckLatest() {\n        let Depth = 3;\n\n        const OriginalVersion = this[s_apiVersion];\n\n        const TestVersion = () => {\n            if (Depth <= 0) {\n                return Promise.reject(new Error(`TDR API is out-of-date (failed to use version ${OriginalVersion}). Please update the library.`));\n            }\n\n            return this.HTTP({\n                url: `${this[s_apiBase]}/rest/v1/applications/versions`,\n                method: \"GET\",\n                headers: this.GetAPIHeaders(),\n            }).then((resp) => {\n                if (!resp || !resp.latest) {\n                    this[s_apiVersion] = this[s_apiVersion].split(\".\").map((x, idx) => idx == 2 ? \"\" + (Number(x) + 1) : x).join(\".\");\n                    this.Log(`Bumping version from ${OriginalVersion} to ${this[s_apiVersion]}`);\n                    Depth--;\n\n                    return TestVersion();\n                }\n\n                return Promise.resolve();\n            });\n        };\n\n        return TestVersion();\n    }\n\n    FetchDeviceID() {\n        if (this[s_deviceID]) return Promise.resolve(this[s_deviceID]);\n\n        return this.Cache.Wrap(\"tdrDeviceID\", () => {\n            return this.HTTP({\n                url: `${this[s_apiBase]}/rest/v1/devices`,\n                method: \"POST\",\n                headers: this.GetAPIHeaders(),\n                data: {}\n            }).then((data) => {\n                if (data && data.deviceId) {\n                    this.Log(`Fetched device ID for TDR: ${data.deviceId}`);\n\n                    this[s_deviceID] = data.deviceId;\n\n                    return this.CheckLatest().then(() => {\n                        return Promise.resolve(data.deviceId);\n                    });\n                }\n\n                return Promise.reject(new Error(`Unable to fetch device ID: ${data}`));\n            });\n        }, 60 * 60 * 24 * 90);\n    }\n\n    FetchWaitTimes() {\n        // first get our ride names etc.\n        return this.FetchRideData().then((rides) => {\n            return this.FetchWaitTimesJSON().then((data) => {\n                for (let i = 0; i < data.attractions.length; i++) {\n                    const ride = data.attractions[i];\n                    // skip any rides we don't recognise\n                    if (!rides[ride.id]) continue;\n                    // skip rides with no wait time service\n                    if (ride.standbyTimeDisplayType == \"FIXED\") continue;\n                    // skip anything not type 1 or 2 (rides and shows)\n                    if (rides[ride.id].type >= 3) continue;\n\n                    let rideObject = this.GetRideObject({\n                        id: ride.id,\n                        name: rides[ride.id].name\n                    });\n\n                    rideObject.FastPass = rides[ride.id].fastpass;\n\n                    if (ride.operatingStatus == \"CLOSE_NOTICE\") {\n                        // ride is temporarily closed\n                        rideObject.WaitTime = -2;\n                    } else if (ride.facilityStatus == \"CANCEL\") {\n                        // ride is closed for the day\n                        rideObject.WaitTime = -1;\n                    } else if (ride.operatingStatus == \"OPEN\") {\n                        rideObject.WaitTime = (ride.standbyTime !== undefined && ride.standbyTime >= 0) ? ride.standbyTime : 0;\n                    } else {\n                        rideObject.WaitTime = -1;\n                    }\n                }\n\n                return Promise.resolve();\n            });\n        });\n    }\n\n    FetchWaitTimesJSON() {\n        return this.FetchDeviceID().then(() => {\n            return this.HTTP({\n                url: `${this[s_apiBase]}/rest/v1/facilities/conditions`,\n                method: \"GET\",\n                headers: this.GetAPIHeaders(),\n            });\n        });\n    }\n\n    FetchRideData() {\n        return this.Cache.Wrap(\"ridedata\", () => {\n            // first get our English ride names\n            return this.GetEnglishNames().then((englishNames) => {\n                return this.FetchDeviceID().then(() => {\n                    // fetch ride data from App API\n                    return this.HTTP({\n                        url: `${this[s_apiBase]}/rest/v1/facilities`,\n                        method: \"GET\",\n                        headers: this.GetAPIHeaders(),\n                    }).then((body) => {\n                        if (!body) {\n                            return Promise.reject(\"Failed to find entries in ride data response\");\n                        }\n\n                        const rideData = {};\n\n                        for (let i = 0; i < body.attractions.length; i++) {\n                            const attr = body.attractions[i];\n\n                            // skip attractions from the other park\n                            if (attr.parkType.toLowerCase() != this[s_parkID]) continue;\n\n                            const englishData = englishNames[Number(attr.facilityCode)];\n\n                            rideData[attr.id] = {\n                                name: englishData && englishData.name !== undefined ? englishData.name : attr.nameKana,\n                                fastpass: !!attr.fastpass,\n                                type: attr.attractionType.id,\n                                facilityCode: Number(attr.facilityCode),\n                            };\n                        }\n\n                        return Promise.resolve(rideData);\n                    });\n                });\n            });\n        }, 86400);\n    }\n\n    GetEnglishNames() {\n        return this.Cache.Wrap(\"ridenames\", () => {\n            // fetch ride names\n            return this.HTTP({\n                url: `https://www.tokyodisneyresort.jp/en/${this[s_parkID]}/attraction.html`,\n                headers: {\n                    \"Referer\": `https://www.tokyodisneyresort.jp/en/${this[s_parkID]}/attraction.html`,\n                    connection: \"keep-alive\",\n                    \"User-Agent\": this[s_webUserAgent]\n                },\n                retryDelay: 1000 * 10\n            }).then((body) => {\n                if (!body) {\n                    return Promise.reject(\"Failed to find entries in English ride names data response\");\n                }\n\n                const regexGetRideNames = /e\">([^<]+)<\\/p>[\\s\\n]*<a href=\"\\/en\\/td[sl]\\/attraction\\/detail\\/([0-9]+)\\/\">[\\s\\n]*<div class=\"headingArea\">[\\s\\n]*<div class=\"headingAreaInner\">[\\s\\n]*<h3 class=\"heading3\">([^<]+)<\\/h3>/g;\n\n                let match;\n                var rideData = {};\n                while (match = regexGetRideNames.exec(body)) {\n                    rideData[Number(match[2])] = {\n                        name: match[3],\n                        area: match[1],\n                    };\n                }\n\n                // add area name to any duplicate names\n                for (let id in rideData) {\n                    const matches = [];\n                    for (let compId in rideData) {\n                        if (rideData[id].name == rideData[compId].name) {\n                            matches.push(compId);\n                        }\n                    }\n\n                    if (matches.length > 1) {\n                        for (let i = 0; i < matches.length; i++) {\n                            rideData[matches[i]].name = `${rideData[matches[i]].area} ${rideData[matches[i]].name}`;\n                        }\n                    }\n                }\n\n                // missing facility 245 from scrape?\n                if (rideData[244] && !rideData[245]) rideData[245] = rideData[244];\n\n                return Promise.resolve(rideData);\n            });\n        }, 86400);\n    }\n\n    FetchCalendarJSON() {\n        const today = Moment().tz(this.Timezone).format(\"YYYY-MM-DD\");\n        return this.FetchDeviceID().then(() => {\n            return this.HTTP({\n                url: `${this[s_apiBase]}/rest/v1/parks/calendars?since=${today}`,\n                method: \"GET\",\n                headers: this.GetAPIHeaders(),\n            });\n        });\n    }\n\n    FetchOpeningTimes() {\n        return this.FetchCalendarJSON().then((data) => {\n            for (let i = 0, day; day = data[i++];) {\n                // skip times for the wrong park\n                if (day.parkType.toLowerCase() != this[s_parkID]) continue;\n\n                this.Schedule.SetDate({\n                    date: Moment.tz(day.date, \"YYYY-MM-DD\", this.Timezone),\n                    openingTime: Moment.tz(`${day.date} ${day.openTime}`, \"YYYY-MM-DD HH:mm\", this.Timezone),\n                    closingTime: Moment.tz(`${day.date} ${day.closeTime}`, \"YYYY-MM-DD HH:mm\", this.Timezone),\n                    type: day.closedDay ? \"Closed\" : \"Operating\",\n                });\n            }\n        });\n    }\n}\n\nmodule.exports = DisneyTokyoPark;"]}