{"version":3,"sources":["../../lib/herschend/index.js"],"names":["Park","require","Moment","Promise","base_url","s_parkID","Symbol","s_calendarURL","s_parkIDs","HerschendBase","options","park_id","Error","calendar_url","parkids","resolve","reject","HTTP","url","then","body","forEach","ride","rideObject","GetRideObject","id","rideId","name","rideName","operationStatus","includes","WaitTime","waitTimeDisplay","parseInt","split","waitTime","bind","rangeStart","tz","Timezone","format","data","headers","scheduleData","i","length","day","schedule","parkHours","from","Schedule","SetDate","date","openingTime","closingTime","to","type","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\n// base park objects\nvar Park = require(\"../park.js\");\n\n// Moment date/time library\nvar Moment = require(\"moment-timezone\");\n\n// include our Promise library\nvar Promise = require(\"../promise\");\n\n// API settings\nvar base_url = \"http://pulse.hfecorp.com/api/waitTimes/\";\n\nvar s_parkID = Symbol();\nvar s_calendarURL = Symbol();\nvar s_parkIDs = Symbol();\n\n/**\n * Implements the Walt Disney World API framework. All Disney parks use this one API.\n * @class\n * @extends Park\n */\nclass HerschendBase extends Park {\n    /**\n     * Create new HerschendBase Object.\n     * This object should not be called directly, but rather extended for each of the individual Herschend Parks\n     * @param {Object} options\n     * @param {String} options.park_id Herschend API park ID\n     * @param {String} options.calendar_url Herschend calendar base URL\n     * @param {String} options.parkids Herschend calendar \"parkids\" value\n     */\n    constructor(options = {}) {\n        // inherit from base class\n        super(options);\n\n        // check we have our park_id\n        if (!options.park_id) {\n            throw new Error(\"No park_id supplied for Herschend park\");\n        }\n        this[s_parkID] = options.park_id;\n\n        if (!options.calendar_url) {\n            throw new Error(\"No calendar URL supplied for Herschend park\");\n        }\n        this[s_calendarURL] = options.calendar_url;\n\n        if (!options.parkids) {\n            throw new Error(\"No parkids supplied for Herschend park\");\n        }\n        this[s_parkIDs] = options.parkids;\n    }\n\n    /**\n     * Fetch this Herschend Park's waiting times\n     * @returns {Promise}\n     */\n    FetchWaitTimes() {\n        return new Promise(function(resolve, reject) {\n            this.HTTP({\n                url: base_url + this[s_parkID]\n            }).then(function(body) {\n                body.forEach((ride) => {\n                    var rideObject = this.GetRideObject({\n                        id: ride.rideId,\n                        name: ride.rideName\n                    });\n\n                    // Assume that all \"UNKNOWN\" times are closed rides.\n                    if (ride.operationStatus.includes(\"CLOSED\") || ride.operationStatus.includes(\"UNKNOWN\")) {\n                        rideObject.WaitTime = -1;\n                    }\n\n                    // Wait time is not defined if text says \"Under x minutes\" - we'll set the ride time to x\n                    else if (ride.waitTimeDisplay.includes(\"UNDER\")) {\n                        rideObject.WaitTime = parseInt(ride.waitTimeDisplay.split(\" \")[1]);\n                    } else {\n                        rideObject.WaitTime = parseInt(ride.waitTime);\n                    }\n                });\n\n                return resolve();\n            }.bind(this), reject);\n        }.bind(this));\n    }\n\n    /**\n     * Fetch this Herschend Park's opening times\n     * @returns {Promise}\n     */\n    FetchOpeningTimes() {\n        return new Promise(function(resolve, reject) {\n            // get today's date and add on a month to get a decent range of dates\n            var rangeStart = Moment.tz(this.Timezone).format(\"YYYY-MM-DD\");\n\n            this.HTTP({\n                url: \"https://\" + this[s_calendarURL] + \"/sitecore/api/hfe/hfedata/dailyschedulebytime\",\n                data: {\n                    \"date\": rangeStart,\n                    \"days\": 30,\n                    \"parkids\": this[s_parkIDs]\n                },\n                headers: {\n                    \"Authorization\": \"Basic ZXh0cmFuZXRcYXBpdXNlcjpKdzdvZGh3RkhwSzRKZw==\"\n                }\n            }).then(function(scheduleData) {\n                // parse each schedule entry\n                for (var i = 0; i < scheduleData.length; i++) {\n                    var day = scheduleData[i];\n\n                    if (day.schedule.parkHours[0].from) {\n                        this.Schedule.SetDate({\n                            date: Moment.tz(day.date, \"YYYY-MM-DD\", this.Timezone),\n                            openingTime: Moment.tz(day.schedule.parkHours[0].from, \"YYYY-MM-DDTHH:mm:ss\", this.Timezone),\n                            closingTime: Moment.tz(day.schedule.parkHours[0].to, \"YYYY-MM-DDTHH:mm:ss\", this.Timezone)\n                        });\n                    } else {\n                        this.Schedule.SetDate({\n                            date: Moment.tz(day.date, \"YYYY-MM-DD\", this.Timezone),\n                            type: \"Closed\"\n                        });\n                    }\n                }\n\n                resolve();\n            }.bind(this), reject);\n        }.bind(this));\n    }\n}\n\n// export just the Base Herschend Park class\nmodule.exports = HerschendBase;"]}