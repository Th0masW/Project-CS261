{"version":3,"sources":["../../lib/bellewaerde/index.js"],"names":["Park","require","Moment","rawRideData","rideData","i","ride","code","s_apiBase","Symbol","s_calendarURL","Bellewaerde","options","name","timezone","latitude","longitude","api_base","calendarURL","Promise","resolve","reject","HTTP","url","then","waittimes","rideNames","ridetime","id","type","rideObject","GetRideObject","WaitTime","Number","wait","bind","endYear","tz","Timezone","add","ScheduleDays","datePointer","years","Log","format","isSameOrBefore","push","all","map","year","FetchYearOpeningTimes","results","hours","times","Schedule","SetDate","method","data","_format","json","openingJSON","result","Object","keys","opening_hours","forEach","key","status","date","openingTime","mo_time","closingTime","mc_time","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["// include core Park class\nvar Park = require(\"../park\");\n\nvar Moment = require(\"moment-timezone\");\n\nvar rawRideData = require(\"./bellewaerdeData.js\");\nvar rideData = {};\nfor (var i = 0, ride; ride = rawRideData[i++];) {\n    rideData[ride.code] = ride;\n}\n\nvar s_apiBase = Symbol();\nvar s_calendarURL = Symbol();\n\n/**\n * Implements the Bellewaerde Park API\n * @class\n * @extends Park\n */\nclass Bellewaerde extends Park {\n    constructor(options = {}) {\n        options.name = options.name || \"Bellewaerde\";\n        options.timezone = options.timezone || \"Europe/Brussels\";\n        options.latitude = options.latitude || 50.846996;\n        options.longitude = options.longitude || 2.947948;\n\n        // inherit from base class\n        super(options);\n\n        // API Options\n        this[s_apiBase] = options.api_base || \"http://bellewaer.de/realtime/api/\";\n        this[s_calendarURL] = options.calendarURL || \"https://www.bellewaerde.be/en/api/calendar/\";\n    }\n\n    FetchWaitTimes() {\n        return new Promise(function (resolve, reject) {\n            this.HTTP({\n                url: this[s_apiBase] + \"api-realtime.php\"\n            }).then(function (waittimes) {\n                // loop over returned data\n                var rideNames = {};\n\n                for (var i = 0, ridetime; ridetime = waittimes[i++];) {\n                    // Filter attractions from poi\n                    if (rideData[ridetime.id] && rideData[ridetime.id].type === \"Attractions\") {\n                        var rideObject = this.GetRideObject({\n                            id: ridetime.id,\n                            name: rideData[ridetime.id].name,\n                        });\n\n                        rideObject.WaitTime = Number(ridetime.wait) || 0;\n                    }\n                }\n\n                resolve(rideNames);\n            }.bind(this), reject);\n        }.bind(this));\n    }\n\n    /**\n     * Request park opening times.\n     * @returns {Promise}\n     */\n    FetchOpeningTimes() {\n        // calculate how many (and which) years we want to check\n        const endYear = Moment().tz(this.Timezone).add(this.ScheduleDays, \"days\");\n        var datePointer = Moment().tz(this.Timezone);\n        const years = [];\n\n        this.Log(`Fetching opening hours between ${datePointer.format()} and ${endYear.format()}`);\n\n        // slide along between start and end until we go past endYear to get an array of required year combos\n        while (datePointer.isSameOrBefore(endYear, \"year\")) {\n            years.push(datePointer.format(\"YYYY\"));\n            datePointer.add(1, \"year\");\n        }\n\n        // loop through each year, calling FetchYearOpeningTimes\n        return Promise.all(years.map((year) => {\n            return this.FetchYearOpeningTimes(year);\n        })).then((results) => {\n            // inject results into calendar\n            results.map((hours) => {\n                hours.map((times) => {\n                    this.Schedule.SetDate(times);\n                });\n            });\n\n            return results;\n        });\n    }\n\n    /**\n     * Fetch park opening times for a specific year and add to park's opening times\n     * @param {String} [year]\n     */\n    FetchYearOpeningTimes(year) {\n        return this.HTTP({\n            url: this[s_calendarURL] + year,\n            method: \"GET\",\n            data: {\n                _format: \"json\"\n            },\n            json: true\n        }).then((openingJSON) => {\n            if (openingJSON === null) {\n                return Promise.reject(\"API didn't return expected format\");\n            }\n\n            var result = [];\n            Object.keys(openingJSON.opening_hours).forEach((key) => {\n                //FYI, status: \"open\" / \"closed\" / \"soldout\"\n                if (openingJSON.opening_hours[key].status === \"open\") {\n                    result.push({\n                        date: Moment.tz(`${key}/${year}`, \"MM/DD/YYYY\", this.Timezone),\n                        openingTime: Moment.tz(`${key}/${year}${openingJSON.opening_hours[key].mo_time}`, \"MM/DD/YYYYHH:mm\", this.Timezone),\n                        closingTime: Moment.tz(`${key}/${year}${openingJSON.opening_hours[key].mc_time}`, \"MM/DD/YYYYHH:mm\", this.Timezone),\n                        type: \"Operating\"\n                    });\n                } else {\n                    result.push({\n                        date: Moment.tz(`${key}/${year}`, \"MM/DD/YYYY\", this.Timezone),\n                        type: \"Closed\"\n                    });\n                }\n            });\n\n            return result;\n        });\n    }\n}\n\n// export the class\nmodule.exports = Bellewaerde;"]}